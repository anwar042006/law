<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Blockchain Evidence Tracking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
        }
        .police-bg {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        .public-bg {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        .court-bg {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
        }
        .form-input {
            transition: all 0.2s ease;
        }
        .form-input:focus {
            transform: translateY(-1px);
        }
        .hidden {
            display: none !important;
        }
        .search-result {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .search-result:hover {
            background-color: #f9fafb;
        }
        .wallet-status {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .wallet-connected {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
        }
        .wallet-disconnected {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
        }
        .wallet-status:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .transaction-loading {
            display: inline-flex;
            align-items: center;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Wallet Status Display -->
    <div id="walletStatus" class="wallet-status wallet-disconnected">
        <div class="flex items-center">
            <i data-lucide="wallet" class="w-5 h-5 mr-2 text-gray-600"></i>
            <div>
                <div id="walletStatusText" class="text-sm font-medium text-gray-800">üî¥ Wallet Disconnected</div>
                <div id="walletAddress" class="text-xs text-gray-600 hidden"></div>
            </div>
            <button id="connectWalletBtn" onclick="connectWallet()" class="ml-3 bg-blue-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-blue-700 transition-colors">
                Connect
            </button>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="min-h-screen">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center mb-12">
                <div class="flex items-center justify-center mb-4">
                    <i data-lucide="shield" class="w-16 h-16 text-blue-600 mr-4"></i>
                    <h1 class="text-4xl font-bold text-gray-900">üîê Evidence Tracking System</h1>
                </div>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Secure blockchain-based evidence management for law enforcement and judicial processes
                </p>
            </div>

            <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                <!-- Police Portal -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <div class="text-center">
                        <i data-lucide="shield" class="w-16 h-16 text-blue-600 mx-auto mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">üëÆ‚Äç‚ôÇÔ∏è Police Portal</h2>
                        <p class="text-gray-600 mb-6">Register and manage evidence cases with secure blockchain storage.</p>
                        <button onclick="showPoliceLogin()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary hover:bg-blue-700">
                            Access Portal
                        </button>
                    </div>
                </div>

                <!-- Public Portal -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <div class="text-center">
                        <i data-lucide="eye" class="w-16 h-16 text-green-600 mx-auto mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">üë• Public Portal</h2>
                        <p class="text-gray-600 mb-6">Track case status using Evidence ID, Aadhaar, or Accused name.</p>
                        <button onclick="showPublicPortal()" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary hover:bg-green-700">
                            Track Cases
                        </button>
                    </div>
                </div>

                <!-- Court Portal -->
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover">
                    <div class="text-center">
                        <i data-lucide="gavel" class="w-16 h-16 text-orange-600 mx-auto mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">‚öñÔ∏è Court Portal</h2>
                        <p class="text-gray-600 mb-6">Review cases and submit judicial decisions with blockchain verification.</p>
                        <button onclick="showCourtLogin()" class="w-full bg-orange-600 text-white py-3 px-6 rounded-lg font-semibold btn-primary hover:bg-orange-700">
                            Access Portal
                        </button>
                    </div>
                </div>
            </div>

            <div class="text-center mt-12">
                <div class="inline-flex items-center bg-white rounded-lg px-6 py-3 shadow-md">
                    <i data-lucide="hash" class="w-5 h-5 text-blue-600 mr-2"></i>
                    <span class="text-gray-700 font-medium">üîó Powered by Blockchain Technology</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Police Login Page -->
    <div id="policeLoginPage" class="min-h-screen police-bg hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <i data-lucide="shield" class="w-16 h-16 text-blue-600 mx-auto mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-900">üëÆ‚Äç‚ôÇÔ∏è Police Login</h2>
                    <p class="text-gray-600">Secure access to evidence management</p>
                </div>

                <form id="policeLoginForm" class="space-y-6">
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                            Username
                        </label>
                        <input type="text" id="policeUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter username" required>
                    </div>

                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i data-lucide="lock" class="w-4 h-4 mr-2"></i>
                            Password
                        </label>
                        <input type="password" id="policePassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter password" required>
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold btn-primary hover:bg-blue-700">
                        üîê Login
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button onclick="showHome()" class="text-blue-600 hover:text-blue-700 font-medium">
                        ‚Üê Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Police Portal -->
    <div id="policePortal" class="min-h-screen police-bg hidden">
        <div class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <i data-lucide="shield" class="w-8 h-8 text-blue-600 mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">üëÆ‚Äç‚ôÇÔ∏è Police Portal</h1>
                </div>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                    üö™ Logout
                </button>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Case Registration Form -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i data-lucide="file-text" class="w-6 h-6 mr-2 text-blue-600"></i>
                        üìù Register New Case
                    </h2>

                    <form id="policeForm" class="space-y-6">
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="user-check" class="w-4 h-4 mr-2"></i>
                                üÜî Aadhaar Number (12 digits)
                            </label>
                            <input type="text" id="aadhaar" maxlength="12" pattern="\d{12}" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter 12-digit Aadhaar number" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                                üë§ Accused Name
                            </label>
                            <input type="text" id="accusedName" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter accused person's name" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                üìã Case Details
                            </label>
                            <textarea id="caseDetails" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter detailed case description" required></textarea>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                üìç Crime Location
                            </label>
                            <input type="text" id="crimeLocation" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter crime location" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                üïê Crime Date & Time
                            </label>
                            <input type="datetime-local" id="crimeDateTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="clock" class="w-4 h-4 mr-2"></i>
                                üìÖ Case Register Date & Time
                            </label>
                            <input type="datetime-local" id="registerDateTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="hash" class="w-4 h-4 mr-2"></i>
                                üè∑Ô∏è Evidence ID
                            </label>
                            <input type="text" id="evidenceId" readonly class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed" placeholder="Auto-generated Evidence ID">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold btn-primary hover:bg-blue-700 flex items-center justify-center">
                            <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                            <span id="policeSubmitText">üìù Register Case on Blockchain</span>
                        </button>
                    </form>
                </div>

                <!-- Case Tracking Section -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i data-lucide="search" class="w-6 h-6 mr-2 text-blue-600"></i>
                        üîç Case Tracking
                    </h2>

                    <div class="mb-4">
                        <input type="text" id="policeSearch" placeholder="üîç Search by Evidence ID, Aadhaar, or Name..." class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div id="policeSearchResults" class="space-y-4 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            üìÇ No cases found. Try a different search term.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Public Portal -->
    <div id="publicPortal" class="min-h-screen public-bg hidden">
        <div class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <i data-lucide="eye" class="w-8 h-8 text-green-600 mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">üë• Public Portal</h1>
                </div>
                <button onclick="showHome()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    üè† Home
                </button>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">üîç Case Tracking</h2>
                    <p class="text-gray-600">Track your case status using Evidence ID, Aadhaar Number, or Accused Name</p>
                </div>

                <div class="mb-8">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-4 top-4 w-5 h-5 text-gray-400"></i>
                        <input type="text" id="publicSearch" placeholder="üîç Enter Evidence ID, Aadhaar Number, or Accused Name..." class="w-full pl-12 pr-4 py-4 border border-gray-300 rounded-lg text-lg form-input focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                </div>

                <div id="publicSearchResults" class="space-y-6">
                    <div class="text-center text-gray-500 py-12">
                        <i data-lucide="eye" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                        <h3 class="text-xl font-medium mb-2">üîç Enter Search Terms</h3>
                        <p>Enter an Evidence ID, Aadhaar Number, or Accused Name to track case status.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Court Login Page -->
    <div id="courtLoginPage" class="min-h-screen court-bg hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <i data-lucide="gavel" class="w-16 h-16 text-orange-600 mx-auto mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-900">‚öñÔ∏è Court Login</h2>
                    <p class="text-gray-600">Secure access to judicial decisions</p>
                </div>

                <form id="courtLoginForm" class="space-y-6">
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                            Username
                        </label>
                        <input type="text" id="courtUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter username" required>
                    </div>

                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                            <i data-lucide="lock" class="w-4 h-4 mr-2"></i>
                            Password
                        </label>
                        <input type="password" id="courtPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter password" required>
                    </div>

                    <button type="submit" class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold btn-primary hover:bg-orange-700">
                        üîê Login
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button onclick="showHome()" class="text-orange-600 hover:text-orange-700 font-medium">
                        ‚Üê Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Court Portal -->
    <div id="courtPortal" class="min-h-screen court-bg hidden">
        <div class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <i data-lucide="gavel" class="w-8 h-8 text-orange-600 mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">‚öñÔ∏è Court Portal</h1>
                </div>
                <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                    üö™ Logout
                </button>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Case Search & Judgment Form -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i data-lucide="scale" class="w-6 h-6 mr-2 text-orange-600"></i>
                        ‚öñÔ∏è Case Judgment
                    </h2>

                    <form id="courtForm" class="space-y-6">
                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="search" class="w-4 h-4 mr-2"></i>
                                üîç Search Case
                            </label>
                            <input type="text" id="courtSearch" placeholder="Search by Evidence ID, Aadhaar, or Name..." class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            
                            <div id="courtSearchDropdown" class="mt-2 border border-gray-200 rounded-lg max-h-48 overflow-y-auto hidden">
                                <!-- Search results will be populated here -->
                            </div>
                        </div>

                        <div id="selectedCaseInfo" class="bg-gray-50 p-4 rounded-lg hidden">
                            <h3 class="font-bold text-gray-900 mb-2">üìã Selected Case</h3>
                            <div id="selectedCaseDetails" class="text-sm space-y-1">
                                <!-- Selected case details will be populated here -->
                            </div>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="gavel" class="w-4 h-4 mr-2"></i>
                                ‚öñÔ∏è Court Judgment
                            </label>
                            <textarea id="judgment" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter court judgment and decision..." required></textarea>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                                üìÖ Closing Date
                            </label>
                            <input type="date" id="closingDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent" required>
                        </div>

                        <div>
                            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                üîÑ Re-judgment (Optional)
                            </label>
                            <textarea id="rejudgment" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter re-judgment details if applicable..."></textarea>
                        </div>

                        <button type="submit" id="courtSubmitBtn" disabled class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold btn-primary hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center">
                            <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                            <span id="courtSubmitText">‚öñÔ∏è Submit Judgment on Blockchain</span>
                        </button>
                    </form>
                </div>

                <!-- Case Tracking Section -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i data-lucide="search" class="w-6 h-6 mr-2 text-orange-600"></i>
                        üîç Case Tracking
                    </h2>

                    <div class="mb-4">
                        <input type="text" id="courtTrackingSearch" placeholder="üîç Search by Evidence ID, Aadhaar, or Name..." class="w-full px-4 py-3 border border-gray-300 rounded-lg form-input focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                    </div>

                    <div id="courtTrackingResults" class="space-y-4 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            üìÇ No cases available for review.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for data storage
        let cases = JSON.parse(localStorage.getItem('evidenceCases')) || [];
        let evidenceCounter = parseInt(localStorage.getItem('evidenceCounter')) || 1;
        let selectedCase = null;
        let walletConnected = false;
        let userAccount = null;
        let web3 = null;

        // Login credentials
        const credentials = {
            police: { username: 'police_admin', password: 'police123' },
            court: { username: 'court_admin', password: 'court123' }
        };

        // Contract ABI and Address (you'll need to deploy the contract and update these)
        const CONTRACT_ADDRESS = "0x6a33A701C31342B6301588Eb2F315ccFE8200d22"; // Update with deployed contract address
        const CONTRACT_ABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "uniqueCaseID",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "aadhaar",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "accused",
				"type": "string"
			}
		],
		"name": "CaseRegistered",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			}
		],
		"name": "JudgmentSubmitted",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "aadhaar",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "accused",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "details",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "location",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "officer",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "crimeDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "regDate",
				"type": "string"
			}
		],
		"name": "registerCase",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "judgmentText",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "closingDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "rejudgment",
				"type": "string"
			}
		],
		"name": "submitJudgment",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "aadhaarCases",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "aadhaarUniqueID",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "accusedCases",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "caseCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "cases",
		"outputs": [
			{
				"internalType": "string",
				"name": "uniqueCaseID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "aadhaar",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "accused",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "details",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "location",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "officer",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "crimeDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "regDate",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "evidenceCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "judgments",
		"outputs": [
			{
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "judgmentText",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "closingDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "rejudgment",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "aadhaar",
				"type": "string"
			}
		],
		"name": "trackByAadhaar",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "uniqueCaseID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "aadhaar",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "accused",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "details",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "location",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "officer",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "crimeDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "regDate",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Case[]",
				"name": "",
				"type": "tuple[]"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "judgmentText",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "closingDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "rejudgment",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Judgment[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "accusedName",
				"type": "string"
			}
		],
		"name": "trackByAccused",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "uniqueCaseID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "aadhaar",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "accused",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "details",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "location",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "officer",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "crimeDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "regDate",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Case[]",
				"name": "",
				"type": "tuple[]"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "judgmentText",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "closingDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "rejudgment",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Judgment[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "evidenceID",
				"type": "string"
			}
		],
		"name": "trackByEvidenceID",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "uniqueCaseID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "aadhaar",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "accused",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "details",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "location",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "officer",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "crimeDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "regDate",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Case",
				"name": "",
				"type": "tuple"
			},
			{
				"components": [
					{
						"internalType": "string",
						"name": "evidenceID",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "judgmentText",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "closingDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "rejudgment",
						"type": "string"
					}
				],
				"internalType": "struct EvidenceTracking.Judgment",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        // Save data to localStorage for permanent storage
        function saveData() {
            localStorage.setItem('evidenceCases', JSON.stringify(cases));
            localStorage.setItem('evidenceCounter', evidenceCounter.toString());
        }

        // Wallet connection functions
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    walletConnected = true;
                    
                    // Initialize Web3
                    web3 = new Web3(window.ethereum);
                    
                    updateWalletStatus();
                    
                    // Listen for account changes
                    window.ethereum.on('accountsChanged', function (accounts) {
                        if (accounts.length === 0) {
                            disconnectWallet();
                        } else {
                            userAccount = accounts[0];
                            updateWalletStatus();
                        }
                    });
                    
                    // Listen for chain changes
                    window.ethereum.on('chainChanged', function (chainId) {
                        window.location.reload();
                    });
                    
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    alert('‚ùå Failed to connect wallet. Please try again.');
                }
            } else {
                alert('ü¶ä Please install MetaMask to use blockchain features.');
            }
        }

        function disconnectWallet() {
            walletConnected = false;
            userAccount = null;
            web3 = null;
            updateWalletStatus();
        }

        function updateWalletStatus() {
            const statusDiv = document.getElementById('walletStatus');
            const statusText = document.getElementById('walletStatusText');
            const addressDiv = document.getElementById('walletAddress');
            const connectBtn = document.getElementById('connectWalletBtn');
            
            if (walletConnected && userAccount) {
                statusDiv.className = 'wallet-status wallet-connected';
                statusText.textContent = 'üü¢ Wallet Connected';
                addressDiv.textContent = `${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                addressDiv.classList.remove('hidden');
                connectBtn.textContent = 'Disconnect';
                connectBtn.onclick = disconnectWallet;
            } else {
                statusDiv.className = 'wallet-status wallet-disconnected';
                statusText.textContent = 'üî¥ Wallet Disconnected';
                addressDiv.classList.add('hidden');
                connectBtn.textContent = 'Connect';
                connectBtn.onclick = connectWallet;
            }
        }

        // Blockchain transaction functions
        async function registerCaseOnBlockchain(caseData) {
            if (!walletConnected || !web3) {
                throw new Error('Wallet not connected');
            }
            
            try {
                const contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                const crimeTimestamp = Math.floor(new Date(caseData.crimeDateTime).getTime() / 1000);
                const registerTimestamp = Math.floor(new Date(caseData.registerDateTime).getTime() / 1000);
                
                const transaction = await contract.methods.registerCase(
                    caseData.evidenceId,
                    caseData.aadhaar,
                    caseData.accusedName,
                    caseData.caseDetails,
                    caseData.crimeLocation,
                    crimeTimestamp,
                    registerTimestamp
                ).send({ from: userAccount });
                
                return transaction;
            } catch (error) {
                console.error('Blockchain transaction failed:', error);
                throw error;
            }
        }

        async function submitJudgmentOnBlockchain(judgmentData) {
            if (!walletConnected || !web3) {
                throw new Error('Wallet not connected');
            }
            
            try {
                const contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                const closingTimestamp = Math.floor(new Date(judgmentData.closingDate).getTime() / 1000);
                
                const transaction = await contract.methods.submitJudgment(
                    judgmentData.evidenceId,
                    judgmentData.judgment,
                    closingTimestamp,
                    judgmentData.rejudgment || ""
                ).send({ from: userAccount });
                
                return transaction;
            } catch (error) {
                console.error('Blockchain transaction failed:', error);
                throw error;
            }
        }

        function setLoadingState(buttonId, textId, loading, loadingText, normalText) {
            const button = document.getElementById(buttonId);
            const text = document.getElementById(textId);
            
            if (loading) {
                button.disabled = true;
                text.innerHTML = `<div class="transaction-loading"><div class="spinner"></div>${loadingText}</div>`;
            } else {
                button.disabled = false;
                text.textContent = normalText;
            }
        }
        // Initialize Lucide icons
        lucide.createIcons();

        // Navigation functions
        function showHome() {
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            clearLoginForms();
        }

        function showPoliceLogin() {
            hideAllPages();
            document.getElementById('policeLoginPage').classList.remove('hidden');
        }

        function showPublicPortal() {
            hideAllPages();
            document.getElementById('publicPortal').classList.remove('hidden');
        }

        function showCourtLogin() {
            hideAllPages();
            document.getElementById('courtLoginPage').classList.remove('hidden');
        }

        function hideAllPages() {
            const pages = ['homePage', 'policeLoginPage', 'policePortal', 'publicPortal', 'courtLoginPage', 'courtPortal'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }

        function logout() {
            clearAllForms();
            showHome();
        }

        function clearLoginForms() {
            document.getElementById('policeLoginForm').reset();
            document.getElementById('courtLoginForm').reset();
        }

        function clearAllForms() {
            // Clear police form
            document.getElementById('policeForm').reset();
            document.getElementById('evidenceId').value = '';
            
            // Clear court form
            document.getElementById('courtForm').reset();
            document.getElementById('selectedCaseInfo').classList.add('hidden');
            document.getElementById('courtSearchDropdown').classList.add('hidden');
            document.getElementById('courtSubmitBtn').disabled = true;
            selectedCase = null;
            
            // Clear login forms
            clearLoginForms();
            
            // Clear search fields
            document.getElementById('policeSearch').value = '';
            document.getElementById('publicSearch').value = '';
            document.getElementById('courtTrackingSearch').value = '';
            
            // Clear search results
            updateSearchResults('policeSearchResults', []);
            updateSearchResults('publicSearchResults', []);
            updateSearchResults('courtTrackingResults', []);
        }

        // Generate Evidence ID
        function generateEvidenceId() {
            return `EV${evidenceCounter.toString().padStart(6, '0')}`;
        }

        // MetaMask connection
        async function connectMetaMask() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    alert('üîó MetaMask connected successfully! Data stored on blockchain.');
                    return true;
                } catch (error) {
                    alert('‚ùå MetaMask connection failed. Please try again.');
                    return false;
                }
            } else {
                alert('ü¶ä Please install MetaMask to store data on blockchain.');
                return false;
            }
        }

        // Search functionality
        function searchCases(searchTerm) {
            if (!searchTerm.trim()) {
                return [];
            }
            return cases.filter(caseData => 
                caseData.evidenceId.toLowerCase().includes(searchTerm.toLowerCase()) ||
                caseData.aadhaar.includes(searchTerm) ||
                caseData.accusedName.toLowerCase().includes(searchTerm.toLowerCase())
            );
        }

        function updateSearchResults(containerId, results) {
            const container = document.getElementById(containerId);
            
            if (results.length === 0) {
                if (containerId === 'publicSearchResults') {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-12">
                            <i data-lucide="search" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                            <h3 class="text-xl font-medium mb-2">üìÇ No Cases Found</h3>
                            <p>No cases match your search criteria. Please check the spelling and try again.</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            üìÇ No cases found. Try a different search term.
                        </div>
                    `;
                }
            } else {
                container.innerHTML = results.map(caseData => {
                    if (containerId === 'publicSearchResults') {
                        return `
                            <div class="border border-gray-200 rounded-lg p-6 hover:border-green-300 transition-colors bg-gray-50">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="space-y-3">
                                        <div class="flex items-center">
                                            <i data-lucide="hash" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üè∑Ô∏è Evidence ID:</strong> ${caseData.evidenceId}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <i data-lucide="user-check" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üÜî Aadhaar:</strong> ${caseData.aadhaar}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <i data-lucide="user" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üë§ Accused:</strong> ${caseData.accusedName}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <i data-lucide="map-pin" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üìç Location:</strong> ${caseData.crimeLocation}</span>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center">
                                            <i data-lucide="calendar" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üïê Crime Date:</strong> ${new Date(caseData.crimeDateTime).toLocaleString()}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <i data-lucide="clock" class="w-5 h-5 text-green-600 mr-2"></i>
                                            <span><strong>üìÖ Registered:</strong> ${new Date(caseData.registerDateTime).toLocaleString()}</span>
                                        </div>
                                        ${caseData.judgment ? `
                                            <div class="flex items-center">
                                                <i data-lucide="scale" class="w-5 h-5 text-green-600 mr-2"></i>
                                                <span><strong>‚öñÔ∏è Status:</strong> Judgment Given</span>
                                            </div>
                                        ` : `
                                            <div class="flex items-center">
                                                <i data-lucide="clock" class="w-5 h-5 text-orange-600 mr-2"></i>
                                                <span><strong>‚è≥ Status:</strong> Pending Judgment</span>
                                            </div>
                                        `}
                                        ${caseData.closingDate ? `
                                            <div class="flex items-center">
                                                <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mr-2"></i>
                                                <span><strong>üìÖ Closed:</strong> ${new Date(caseData.closingDate).toLocaleDateString()}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <p><strong>üìã Case Details:</strong> ${caseData.caseDetails}</p>
                                    ${caseData.judgment ? `<p class="mt-2"><strong>‚öñÔ∏è Court Judgment:</strong> ${caseData.judgment}</p>` : ''}
                                    ${caseData.rejudgment ? `<p class="mt-2"><strong>üîÑ Re-judgment:</strong> ${caseData.rejudgment}</p>` : ''}
                                </div>
                            </div>
                        `;
                    } else {
                        const statusColor = caseData.judgment ? 'text-green-600' : 'text-orange-600';
                        const statusText = caseData.judgment ? '‚úÖ Judgment Given' : '‚è≥ Pending Judgment';
                        
                        return `
                            <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div><strong>üè∑Ô∏è Evidence ID:</strong> ${caseData.evidenceId}</div>
                                    <div><strong>üÜî Aadhaar:</strong> ${caseData.aadhaar}</div>
                                    <div><strong>üë§ Accused:</strong> ${caseData.accusedName}</div>
                                    <div><strong>üìç Location:</strong> ${caseData.crimeLocation}</div>
                                    <div class="col-span-2"><strong>üìã Details:</strong> ${caseData.caseDetails}</div>
                                    <div class="col-span-2 ${statusColor}"><strong>Status:</strong> ${statusText}</div>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }
            
            // Reinitialize Lucide icons for new content
            lucide.createIcons();
        }

        // Police login
        document.getElementById('policeLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('policeUsername').value;
            const password = document.getElementById('policePassword').value;
            
            if (username === credentials.police.username && password === credentials.police.password) {
                hideAllPages();
                document.getElementById('policePortal').classList.remove('hidden');
                document.getElementById('evidenceId').value = generateEvidenceId();
                // Clear login form only
                document.getElementById('policeLoginForm').reset();
            } else {
                alert('‚ùå Invalid credentials. Please try again.');
            }
        });

        // Court login
        document.getElementById('courtLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('courtUsername').value;
            const password = document.getElementById('courtPassword').value;
            
            if (username === credentials.court.username && password === credentials.court.password) {
                hideAllPages();
                document.getElementById('courtPortal').classList.remove('hidden');
                // Clear login form only
                document.getElementById('courtLoginForm').reset();
            } else {
                alert('‚ùå Invalid credentials. Please try again.');
            }
        });

        // Police form submission
        document.getElementById('policeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!walletConnected) {
                alert('‚ùå Please connect your wallet first to register cases on blockchain.');
                return;
            }
            
            const aadhaar = document.getElementById('aadhaar').value;
            
            // Validate Aadhaar
            if (aadhaar.length !== 12 || !/^\d{12}$/.test(aadhaar)) {
                alert('‚ùå Aadhaar number must be exactly 12 digits.');
                return;
            }

            const newCase = {
                evidenceId: document.getElementById('evidenceId').value,
                aadhaar: aadhaar,
                accusedName: document.getElementById('accusedName').value,
                caseDetails: document.getElementById('caseDetails').value,
                crimeLocation: document.getElementById('crimeLocation').value,
                crimeDateTime: document.getElementById('crimeDateTime').value,
                registerDateTime: document.getElementById('registerDateTime').value,
                timestamp: new Date().toISOString()
            };

            // Set loading state
            setLoadingState('policeForm', 'policeSubmitText', true, '‚è≥ Processing Transaction...', 'üìù Register Case on Blockchain');
            
            try {
                // Register case on blockchain
                const transaction = await registerCaseOnBlockchain(newCase);
                
                // Add transaction hash to case data
                newCase.transactionHash = transaction.transactionHash;
                newCase.blockNumber = transaction.blockNumber;
                
                // Save to local storage
                cases.push(newCase);
                evidenceCounter++;
                saveData(); // Save to localStorage
                
                // Clear form and set new evidence ID
                document.getElementById('policeForm').reset();
                document.getElementById('evidenceId').value = generateEvidenceId();
                
                alert(`‚úÖ Case registered successfully on blockchain!\n\nEvidence ID: ${newCase.evidenceId}\nTransaction Hash: ${transaction.transactionHash}\nBlock Number: ${transaction.blockNumber}`);
                
            } catch (error) {
                console.error('Error registering case:', error);
                alert('‚ùå Failed to register case on blockchain. Please try again.');
            } finally {
                // Reset loading state
                setLoadingState('policeForm', 'policeSubmitText', false, '', 'üìù Register Case on Blockchain');
            }
        });

        // Court form submission
        document.getElementById('courtForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!walletConnected) {
                alert('‚ùå Please connect your wallet first to submit judgments on blockchain.');
                return;
            }
            
            if (!selectedCase) {
                alert('‚ùå Please select a case first.');
                return;
            }

            const judgmentData = {
                evidenceId: selectedCase.evidenceId,
                judgment: document.getElementById('judgment').value,
                closingDate: document.getElementById('closingDate').value,
                rejudgment: document.getElementById('rejudgment').value
            };

            const updatedCase = {
                ...selectedCase,
                ...judgmentData,
                judgmentTimestamp: new Date().toISOString()
            };

            // Set loading state
            setLoadingState('courtSubmitBtn', 'courtSubmitText', true, '‚è≥ Processing Transaction...', '‚öñÔ∏è Submit Judgment on Blockchain');
            
            try {
                // Submit judgment on blockchain
                const transaction = await submitJudgmentOnBlockchain(judgmentData);
                
                // Add transaction hash to case data
                updatedCase.judgmentTransactionHash = transaction.transactionHash;
                updatedCase.judgmentBlockNumber = transaction.blockNumber;
                
                // Update local storage
                const index = cases.findIndex(c => c.evidenceId === selectedCase.evidenceId);
                if (index !== -1) {
                    cases[index] = updatedCase;
                    saveData(); // Save to localStorage
                }

                // Clear form
                document.getElementById('courtForm').reset();
                document.getElementById('selectedCaseInfo').classList.add('hidden');
                document.getElementById('courtSearchDropdown').classList.add('hidden');
                document.getElementById('courtSubmitBtn').disabled = true;
                selectedCase = null;

                alert(`‚úÖ Court judgment submitted successfully on blockchain!\n\nEvidence ID: ${updatedCase.evidenceId}\nTransaction Hash: ${transaction.transactionHash}\nBlock Number: ${transaction.blockNumber}`);
                
            } catch (error) {
                console.error('Error submitting judgment:', error);
                alert('‚ùå Failed to submit judgment on blockchain. Please try again.');
            } finally {
                // Reset loading state
                setLoadingState('courtSubmitBtn', 'courtSubmitText', false, '', '‚öñÔ∏è Submit Judgment on Blockchain');
            }
        });

        // Aadhaar auto-fill functionality
        document.getElementById('aadhaar').addEventListener('input', function(e) {
            const aadhaar = e.target.value;
            if (aadhaar.length === 12) {
                const existingCase = cases.find(c => c.aadhaar === aadhaar);
                if (existingCase) {
                    document.getElementById('accusedName').value = existingCase.accusedName;
                    // Show notification that name was auto-filled
                    const nameField = document.getElementById('accusedName');
                    nameField.style.backgroundColor = '#dcfce7';
                    setTimeout(() => {
                        nameField.style.backgroundColor = '';
                    }, 2000);
                }
            }
        });

        // Search functionality for all portals
        document.getElementById('policeSearch').addEventListener('input', function(e) {
            const results = searchCases(e.target.value);
            updateSearchResults('policeSearchResults', results);
        });

        document.getElementById('publicSearch').addEventListener('input', function(e) {
            const results = searchCases(e.target.value);
            updateSearchResults('publicSearchResults', results);
        });

        document.getElementById('courtTrackingSearch').addEventListener('input', function(e) {
            const results = searchCases(e.target.value);
            updateSearchResults('courtTrackingResults', results);
        });

        // Court search with dropdown
        document.getElementById('courtSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value;
            const results = searchCases(searchTerm);
            const dropdown = document.getElementById('courtSearchDropdown');
            
            if (searchTerm && results.length > 0 && !selectedCase) {
                dropdown.innerHTML = results.map(caseData => `
                    <div class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 search-result" onclick="selectCase('${caseData.evidenceId}')">
                        <div class="font-medium">${caseData.evidenceId} - ${caseData.accusedName}</div>
                        <div class="text-sm text-gray-600">${caseData.caseDetails.substring(0, 100)}...</div>
                    </div>
                `).join('');
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        });

        // Select case for court judgment
        function selectCase(evidenceId) {
            selectedCase = cases.find(c => c.evidenceId === evidenceId);
            if (selectedCase) {
                document.getElementById('courtSearch').value = selectedCase.evidenceId;
                document.getElementById('courtSearchDropdown').classList.add('hidden');
                
                document.getElementById('selectedCaseDetails').innerHTML = `
                    <div><strong>üè∑Ô∏è Evidence ID:</strong> ${selectedCase.evidenceId}</div>
                    <div><strong>üë§ Accused:</strong> ${selectedCase.accusedName}</div>
                    <div><strong>üÜî Aadhaar:</strong> ${selectedCase.aadhaar}</div>
                    <div><strong>üìã Details:</strong> ${selectedCase.caseDetails}</div>
                    <div><strong>üìç Location:</strong> ${selectedCase.crimeLocation}</div>
                    <div><strong>üïê Crime Date:</strong> ${new Date(selectedCase.crimeDateTime).toLocaleString()}</div>
                `;
                document.getElementById('selectedCaseInfo').classList.remove('hidden');
                document.getElementById('courtSubmitBtn').disabled = false;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            showHome();
            lucide.createIcons();
            updateWalletStatus();
            
            // Load existing cases on page load
            if (cases.length > 0) {
                console.log(`üìä Loaded ${cases.length} existing cases from storage`);
            }
            
            // Check if wallet is already connected
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            userAccount = accounts[0];
                            walletConnected = true;
                            web3 = new Web3(window.ethereum);
                            updateWalletStatus();
                        }
                    })
                    .catch(console.error);
            }
        });
    </script>
    
    <!-- Web3.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
</body>
</html>
