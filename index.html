<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Evidence Tracking System</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(120deg, #1e3c72, #2a5298);
        color: #fff;
        text-align: center;
        padding: 20px;
    }
    h1 { margin-bottom: 5px; }
    .container {
        background: rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 10px;
        max-width: 900px;
        margin: auto;
        margin-bottom: 30px;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    input, textarea, select, button {
        padding: 10px;
        margin: 5px;
        width: 90%;
        border-radius: 5px;
        border: none;
        outline: none;
        font-size: 14px;
    }
    button {
        background: #ff9800;
        color: #fff;
        cursor: pointer;
        transition: 0.3s;
    }
    button:hover { background: #e68900; }
    textarea { resize: vertical; }
</style>
</head>
<body>

<h1>Evidence Tracking System</h1>
<p>Blockchain-based Case & Evidence Management</p>

<div class="container">
    <h2>Police Portal - Register Evidence</h2>
    <input type="text" id="aadhaar" placeholder="Aadhaar ID">
    <input type="text" id="accusedName" placeholder="Accused Name">
    <textarea id="caseDetails" placeholder="Case Details"></textarea>
    <input type="text" id="crimeLocation" placeholder="Crime Location">
    <input type="text" id="officerName" placeholder="Officer Name">
    <input type="datetime-local" id="crimeDateTime">
    <input type="datetime-local" id="registrationDateTime">
    <button onclick="registerEvidence()">Register Evidence</button>
</div>

<div class="container">
    <h2>Court Portal - Update Judgment</h2>
    <input type="text" id="updateEvidenceId" placeholder="Evidence ID">
    <textarea id="judgmentText" placeholder="Judgment Text"></textarea>
    <input type="date" id="closingDate">
    <button onclick="updateCaseDetails()">Update Case</button>
</div>

<div class="container">
    <h2>Court Portal - Add Review</h2>
    <input type="text" id="reviewEvidenceId" placeholder="Evidence ID">
    <textarea id="reviewText" placeholder="Review Comment"></textarea>
    <button onclick="addReview()">Add Review</button>
</div>

<div class="container">
    <h2>Public Portal - Track Evidence</h2>
    <input type="text" id="searchEvidenceId" placeholder="Evidence ID">
    <button onclick="getEvidenceDetails()">Search</button>
    <pre id="searchResult" style="text-align:left;white-space:pre-wrap;"></pre>
</div>

<script>
let web3;
let contract;
const contractAddress = "=0x324362c778E28357DF206388E21FC08D81997eBC";
const contractABI = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_evidenceId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_comment",
				"type": "string"
			}
		],
		"name": "addReview",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_evidenceId",
				"type": "string"
			}
		],
		"name": "exists",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllEvidenceIds",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_evidenceId",
				"type": "string"
			}
		],
		"name": "getEvidenceDetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "uniqueCaseId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "evidenceId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "aadhaarId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "accusedName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "caseDetails",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "crimeLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "officerName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "crimeDateTime",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "registrationDateTime",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "judgmentText",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "closingDate",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_aadhaarId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_accusedName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_caseDetails",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_crimeLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_officerName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_crimeDateTime",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_registrationDateTime",
				"type": "string"
			}
		],
		"name": "registerEvidence",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_evidenceId",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_judgmentText",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_closingDate",
				"type": "string"
			}
		],
		"name": "updateCaseDetails",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]; // Replace with ABI from your contract

window.addEventListener('load', async () => {
    if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await ethereum.request({ method: 'eth_requestAccounts' });
        contract = new web3.eth.Contract(contractABI, contractAddress);
        console.log("Connected to MetaMask");
    } else {
        alert("Please install MetaMask to use this app.");
    }
});

async function registerEvidence() {
    const accounts = await web3.eth.getAccounts();
    await contract.methods.registerEvidence(
        document.getElementById("aadhaar").value,
        document.getElementById("accusedName").value,
        document.getElementById("caseDetails").value,
        document.getElementById("crimeLocation").value,
        document.getElementById("officerName").value,
        document.getElementById("crimeDateTime").value,
        document.getElementById("registrationDateTime").value
    ).send({ from: accounts[0] });
    alert("Evidence Registered Successfully");
}

async function updateCaseDetails() {
    const accounts = await web3.eth.getAccounts();
    await contract.methods.updateCaseDetails(
        document.getElementById("updateEvidenceId").value,
        document.getElementById("judgmentText").value,
        document.getElementById("closingDate").value
    ).send({ from: accounts[0] });
    alert("Case Updated Successfully");
}

async function addReview() {
    const accounts = await web3.eth.getAccounts();
    await contract.methods.addReview(
        document.getElementById("reviewEvidenceId").value,
        document.getElementById("reviewText").value
    ).send({ from: accounts[0] });
    alert("Review Added Successfully");
}

async function getEvidenceDetails() {
    try {
        const details = await contract.methods.getEvidenceDetails(
            document.getElementById("searchEvidenceId").value
        ).call();
        let output = `
        Unique Case ID: ${details[0]}
        Evidence ID: ${details[1]}
        Aadhaar ID: ${details[2]}
        Accused Name: ${details[3]}
        Case Details: ${details[4]}
        Crime Location: ${details[5]}
        Officer Name: ${details[6]}
        Crime Date & Time: ${details[7]}
        Registration Date & Time: ${details[8]}
        Judgment Text: ${details[9]}
        Closing Date: ${details[10]}
        `;
        document.getElementById("searchResult").textContent = output;
    } catch (err) {
        document.getElementById("searchResult").textContent = "Evidence not found.";
    }
}
</script>

</body>
</html>
