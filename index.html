<!DOCTYPE html>
<html>
<head>
  <title>Evidence Tracking System</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body {
      background: #f4f6f8;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
      padding: 20px;
    }
    select, input, button, textarea {
      padding: 10px;
      margin: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    .hidden { display: none; }
    .container {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      margin-bottom: 30px;
    }
    h2 { color: #007BFF; }
    button { background-color: #007BFF; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .row { margin-top: 15px; }
  </style>
</head>
<body>

  <div class="container" id="loginContainer">
    <h2>Login Page</h2>
    <label>Select Role:</label>
    <select id="roleSelect">
      <option value="public">Public</option>
      <option value="police">Police</option>
      <option value="court">Court</option>
    </select><br>

    <div id="credentials" class="hidden">
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
    </div>
    <button onclick="login()">Login</button>
  </div>

  <div class="container hidden" id="policePortal">
    <h2>üëÆ Police Portal</h2>
    <div>
      <h3>Register New Case</h3>
      <input id="aadhaar" placeholder="Aadhaar ID" />
      <input id="accusedName" placeholder="Accused Name" />
      <textarea id="caseDesc" placeholder="Case Description"></textarea>
      <input id="location" placeholder="Crime Location" />
      <input id="officer" placeholder="Officer Name" />
      <input id="crimeDateTime" type="datetime-local" placeholder="Crime Date/Time" />
      <button onclick="registerCase()">Register Case</button>
    </div>

    <div class="row">
      <h3>Track Case</h3>
      <input id="policeTrackInput" placeholder="Evidence ID or Accused Name" />
      <button onclick="trackCase('policeTrackInput')">Track</button>
      <pre id="policeTrackResult"></pre>
    </div>
  </div>

  <div class="container hidden" id="courtPortal">
    <h2>‚öñÔ∏è Court Portal</h2>

    <div>
      <h3>Enter Judgment</h3>
      <select id="courtEvidenceList"></select><br>
      <input id="courtEntry" placeholder="Evidence ID or Accused Name" />
      <textarea id="judgmentText" placeholder="Judgment Text"></textarea>
      <input id="closingDate" type="date" />
      <button onclick="submitJudgment()">Submit Judgment</button>
    </div>

    <div class="row">
      <h3>Track Case</h3>
      <input id="courtTrackInput" placeholder="Evidence ID or Accused Name" />
      <button onclick="trackCase('courtTrackInput')">Track</button>
      <pre id="courtTrackResult"></pre>
    </div>
  </div>

  <div class="container hidden" id="publicPortal">
    <h2>üßë‚Äçü§ù‚Äçüßë Public Portal</h2>
    <input id="publicTrackInput" placeholder="Evidence ID or Accused Name" />
    <button onclick="trackCase('publicTrackInput')">Track</button>
    <pre id="publicTrackResult"></pre>
  </div>

  <script>
    const courtUsers = { "court": "court123" };
    const policeUsers = { "police": "police123" };

    const contractAddress = "PASTE_YOUR_DEPLOYED_CONTRACT_ADDRESS";
    const contractABI = [ /* Replace this with actual ABI */ ];

    let contract;

    async function loadContract() {
      if (window.ethereum) {
        window.web3 = new Web3(window.ethereum);
        await window.ethereum.enable();
        const accounts = await web3.eth.getAccounts();
        contract = new web3.eth.Contract(contractABI, contractAddress, { from: accounts[0] });
        loadEvidenceList();
      }
    }

    function login() {
      const role = document.getElementById("roleSelect").value;
      const loginDiv = document.getElementById("credentials");
      if (role === "public") {
        hideAll();
        document.getElementById("publicPortal").classList.remove("hidden");
      } else {
        loginDiv.classList.remove("hidden");
        const user = document.getElementById("username").value;
        const pass = document.getElementById("password").value;
        if (role === "police" && policeUsers[user] === pass) {
          hideAll();
          document.getElementById("policePortal").classList.remove("hidden");
        } else if (role === "court" && courtUsers[user] === pass) {
          hideAll();
          document.getElementById("courtPortal").classList.remove("hidden");
        } else {
          alert("Invalid credentials!");
        }
      }
    }

    function hideAll() {
      ["loginContainer", "policePortal", "courtPortal", "publicPortal"].forEach(id => {
        document.getElementById(id).classList.add("hidden");
      });
    }

    async function registerCase() {
      const aadhaar = document.getElementById("aadhaar").value;
      const accused = document.getElementById("accusedName").value;
      const desc = document.getElementById("caseDesc").value;
      const loc = document.getElementById("location").value;
      const officer = document.getElementById("officer").value;
      const dt = document.getElementById("crimeDateTime").value;
      const accs = await web3.eth.getAccounts();
      await contract.methods.registerCase(aadhaar, accused, desc, loc, officer, dt)
        .send({ from: accs[0] });

      alert("Case Registered Successfully!");
    }

    async function submitJudgment() {
      const input = document.getElementById("courtEntry").value;
      const text = document.getElementById("judgmentText").value;
      const closing = document.getElementById("closingDate").value;
      const accs = await web3.eth.getAccounts();
      await contract.methods.submitJudgment(input, text, closing).send({ from: accs[0] });
      alert("Judgment submitted");
    }

    async function trackCase(inputId) {
      const val = document.getElementById(inputId).value;
      const res = await contract.methods.trackCase(val).call();
      const output = `
üÜî Unique ID: ${res.uniqueID}
üìÑ Evidence ID: ${res.evidenceID}
üìÅ Case: ${res.caseDetails}
üìç Location: ${res.location}
üë§ Accused: ${res.accused}
üëÆ Officer: ${res.officer}
üïí Crime Time: ${res.crimeDateTime}
‚öñ Judgment: ${res.judgmentText || "Pending"}
üìÖ Closing: ${res.closingDate || "Pending"}
      `;
      document.getElementById(inputId.replace("Input", "Result")).innerText = output;
    }

    async function loadEvidenceList() {
      const list = await contract.methods.getAllEvidenceIDs().call();
      const sel = document.getElementById("courtEvidenceList");
      sel.innerHTML = "";
      list.forEach(eid => {
        const opt = document.createElement("option");
        opt.text = eid;
        opt.value = eid;
        sel.appendChild(opt);
      });
    }

    window.addEventListener('load', loadContract);
  </script>
</body>
</html>
