<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Evidence Tracking with Username/Password Login</title>
<script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
<style>
  body {
    background: #121212; color: #f0f0f0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex; flex-direction: column; align-items: center;
    padding: 2rem;
  }
  h1 { color: #00b894; }
  .container {
    background: #1e1e1e; padding: 2rem; border-radius: 12px;
    box-shadow: 0 0 20px #00b894aa; max-width: 400px; width: 100%;
    margin-bottom: 2rem;
  }
  input[type="text"], input[type="password"] {
    width: 100%; padding: 0.7rem 1rem; margin-bottom: 1rem;
    border-radius: 8px; border: none; background: #272727;
    color: #f0f0f0; font-size: 1rem;
  }
  input[type="text"]:focus, input[type="password"]:focus {
    outline: none; background: #00b894; color: #121212;
    box-shadow: 0 0 8px #00b894cc;
  }
  button {
    width: 100%; padding: 0.75rem; border-radius: 8px; border:none;
    background: #00b894; color: #121212; font-weight: 700;
    font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 12px #00b894bb;
  }
  button:hover {
    background: #019e76; color: #e0ffe7; box-shadow: 0 6px 18px #019e7677;
  }
  #blockchainUI { display: none; }
  pre {
    background: #272727; border-radius: 10px; padding: 1rem;
    white-space: pre-wrap; word-wrap: break-word; margin-top: 1rem;
    box-shadow: inset 0 0 10px #00b89466; min-height: 5rem;
  }
</style>
</head>
<body>

<h1>Evidence Tracking System</h1>

<div class="container" id="loginContainer">
  <h3>Login</h3>
  <input type="text" id="username" placeholder="Username" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="handleLogin()">Login</button>
  <p id="loginMessage" style="color:#ff6b6b; font-weight:600; margin-top: 0.5rem;"></p>
</div>

<div id="blockchainUI" class="container">
  <h3>Blockchain Evidence Tracking</h3>
  
  <input type="text" id="evidenceId" placeholder="Evidence ID" />
  <input type="text" id="description" placeholder="Description" />
  <input type="text" id="location" placeholder="Location" />
  <button onclick="registerEvidence()">Register Evidence</button>
  
  <hr style="border-color:#00b89466; margin: 1.5rem 0;" />
  
  <input type="text" id="queryEvidenceId" placeholder="Evidence ID" />
  <button onclick="getEvidence()">Get Evidence Details</button>
  <pre id="evidenceDetails"></pre>
</div>

<script>
  // ======== Demo: Simple username-password auth ========
  const validUsers = {
    "officer1": "password123",
    "admin": "adminpass"
  };

  function handleLogin() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const message = document.getElementById('loginMessage');

    if (!username || !password) {
      message.textContent = 'Please enter username and password.';
      return;
    }

    if (validUsers[username] && validUsers[username] === password) {
      // Login success
      message.textContent = '';
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('blockchainUI').style.display = 'block';
      initBlockchain();
    } else {
      message.textContent = 'Invalid username or password.';
    }
  }

  // ======= Blockchain interaction =======
  let web3;
  let contract;
  const contractAddress = 'YOUR_CONTRACT_ADDRESS_HERE';
  const contractABI = [
    {
      "inputs": [
        {"internalType": "string","name": "evidenceId","type": "string"},
        {"internalType": "string","name": "description","type": "string"},
        {"internalType": "string","name": "location","type": "string"}
      ],
      "name": "registerEvidence",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {"internalType": "string","name": "evidenceId","type": "string"}
      ],
      "name": "getEvidence",
      "outputs": [
        {"internalType": "string","name": "","type": "string"},
        {"internalType": "string","name": "","type": "string"},
        {"internalType": "uint256","name": "","type": "uint256"},
        {"internalType": "address","name": "","type": "address"}
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ];

  async function initBlockchain() {
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      try {
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        contract = new web3.eth.Contract(contractABI, contractAddress);
      } catch (err) {
        alert('Please connect your MetaMask wallet.');
      }
    } else {
      alert('Please install MetaMask to use this DApp.');
    }
  }

  async function registerEvidence() {
    const evidenceId = document.getElementById('evidenceId').value.trim();
    const description = document.getElementById('description').value.trim();
    const location = document.getElementById('location').value.trim();

    if (!evidenceId || !description || !location) {
      alert('Fill all fields to register evidence.');
      return;
    }
    const accounts = await web3.eth.getAccounts();

    contract.methods.registerEvidence(evidenceId, description, location)
      .send({ from: accounts[0] })
      .on('receipt', () => alert('Evidence registered!'))
      .on('error', e => alert('Error: ' + e.message));
  }

  async function getEvidence() {
    const evidenceId = document.getElementById('queryEvidenceId').value.trim();
    if (!evidenceId) {
      alert('Enter an Evidence ID.');
      return;
    }
    try {
      const result = await contract.methods.getEvidence(evidenceId).call();
      const [description, location, timestamp, collectedBy] = result;
      const date = new Date(timestamp * 1000);
      document.getElementById('evidenceDetails').textContent =
        `Description: ${description}\nLocation: ${location}\nCollected At: ${date.toLocaleString()}\nCollected By: ${collectedBy}`;
    } catch (err) {
      alert('Error fetching evidence or not found.');
      document.getElementById('evidenceDetails').textContent = '';
    }
  }
</script>

</body>
</html>

