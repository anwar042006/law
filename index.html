<!DOCTYPE html>
<html>
<head>
  <title>Evidence Tracking System</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body { background: #f2f2f2; font-family: Arial; text-align: center; }
    .container { margin: 20px auto; padding: 20px; max-width: 700px; background: #fff; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    select, input, textarea, button { margin: 10px; padding: 8px; width: 90%; border-radius: 5px; border: 1px solid #aaa; }
    h2 { color: #333; }
    .hidden { display: none; }
  </style>
</head>
<body>
<div class="container">
  <h2>Login Portal</h2>
  <select id="roleSelect">
    <option value="">Select Role</option>
    <option value="police">Police</option>
    <option value="court">Court</option>
    <option value="public">Public</option>
  </select>
  <div id="loginSection" class="hidden">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
  <div id="policePortal" class="hidden">
    <h2>Police - Register New Case</h2>
    <input id="aadhaar" placeholder="Aadhaar ID">
    <input id="accused" placeholder="Accused Name">
    <input id="caseDetail" placeholder="Case Details">
    <input id="location" placeholder="Crime Location">
    <input id="officer" placeholder="Officer Name">
    <input id="caseDateTime" placeholder="Crime Date and Time">
    <input id="regDateTime" placeholder="Registration Date and Time">
    <button onclick="registerCase()">Register Case</button>

    <h3>Track Case</h3>
    <input id="trackInputPolice" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('police')">Track</button>
    <pre id="policeOutput"></pre>
  </div>

  <div id="courtPortal" class="hidden">
    <h2>Court - Submit Judgment</h2>
    <select id="evidenceDropdown"></select>
    <textarea id="judgmentText" placeholder="Judgment Text"></textarea>
    <input id="closingDate" placeholder="Closing Date">
    <button onclick="submitJudgment()">Submit</button>

    <h3>Track Case</h3>
    <input id="trackInputCourt" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('court')">Track</button>
    <pre id="courtOutput"></pre>
  </div>

  <div id="publicPortal" class="hidden">
    <h2>Public - Track Case</h2>
    <input id="trackInputPublic" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('public')">Track</button>
    <pre id="publicOutput"></pre>
  </div>
</div>

<script>
  let contract;
  let account;
  const CONTRACT_ADDRESS = 'YOUR_CONTRACT_ADDRESS';
  const ABI = [ /* INSERT ABI HERE FROM REMIX */ ];

  window.addEventListener('load', async () => {
    if (window.ethereum) {
      const web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      const accounts = await web3.eth.getAccounts();
      account = accounts[0];
      contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
      populateEvidenceDropdown();
    }
  });

  document.getElementById('roleSelect').addEventListener('change', e => {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('policePortal').classList.add('hidden');
    document.getElementById('courtPortal').classList.add('hidden');
    document.getElementById('publicPortal').classList.add('hidden');

    const role = e.target.value;
    if (role === 'police' || role === 'court') {
      document.getElementById('loginSection').classList.remove('hidden');
    } else if (role === 'public') {
      document.getElementById('publicPortal').classList.remove('hidden');
    }
  });

  function login() {
    const role = document.getElementById('roleSelect').value;
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    if ((role === 'police' && user === 'police' && pass === '1234') ||
        (role === 'court' && user === 'court' && pass === '1234')) {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById(role + 'Portal').classList.remove('hidden');
    } else {
      alert('Invalid credentials');
    }
  }

  async function registerCase() {
    const aadhaar = document.getElementById('aadhaar').value;
    const accused = document.getElementById('accused').value;
    const caseDetail = document.getElementById('caseDetail').value;
    const location = document.getElementById('location').value;
    const officer = document.getElementById('officer').value;
    const caseDT = document.getElementById('caseDateTime').value;
    const regDT = document.getElementById('regDateTime').value;
    await contract.methods.registerEvidence(aadhaar, accused, caseDetail, location, officer, caseDT, regDT)
      .send({ from: account });
    alert('Case registered!');
    populateEvidenceDropdown();
  }

  async function trackCase(role) {
    const input = document.getElementById(`trackInput${capitalize(role)}`).value;
    const ids = await contract.methods.getAllEvidenceIds().call();
    for (let eid of ids) {
      const data = await contract.methods.getEvidence(eid).call();
      if (data[1] === input || data[2].toLowerCase() === input.toLowerCase()) {
        const output = `
üÜî Unique ID: ${data[0]}
üìÑ Evidence ID: ${data[1]}
üë§ Accused: ${data[2]}
üìÅ Case: ${data[3]}
üìç Location: ${data[4]}
üëÆ Officer: ${data[5]}
üïí Crime Time: ${data[6]}
üóì Registered: ${data[7]}
‚öñ Judgment: ${data[8] || 'Pending'}
üìÖ Closing: ${data[9] || 'Pending'}
        `;
        document.getElementById(`${role}Output`).textContent = output;
        return;
      }
    }
    alert('No record found');
  }

  async function submitJudgment() {
    const eid = document.getElementById('evidenceDropdown').value;
    const judgment = document.getElementById('judgmentText').value;
    const closing = document.getElementById('closingDate').value;
    await contract.methods.updateJudgment(eid, judgment, closing).send({ from: account });
    alert('Judgment submitted');
  }

  async function populateEvidenceDropdown() {
    if (!contract) return;
    const list = document.getElementById('evidenceDropdown');
    list.innerHTML = '';
    const ids = await contract.methods.getAllEvidenceIds().call();
    for (let eid of ids) {
      const opt = document.createElement('option');
      opt.value = eid;
      opt.textContent = eid;
      list.appendChild(opt);
    }
  }

  function capitalize(word) {
    return word.charAt(0).toUpperCase() + word.slice(1);
  }
</script>
</body>
</html>

