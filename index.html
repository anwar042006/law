<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blockchain Evidence Tracking â€” On-Chain</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
body { font-family: Arial, sans-serif; background: linear-gradient(to right,#2c3e50,#3498db); color: #fff; margin:0; }
.container { max-width:1200px; margin:auto; padding:20px; }
.hidden { display:none; }
.card { background:#34495e; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 6px rgba(0,0,0,0.3);}
input,select,textarea,button { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none; }
button { background:#3498db; color:#fff; cursor:pointer; font-weight:bold; }
button:hover { background:#2980b9; }
h2 { color:#f1c40f; }
</style>
</head>
<body>
<div class="container">
  <div id="loginSection" class="card">
    <h2>Login</h2>
    <label for="role">Select Role</label>
    <select id="role">
      <option value="public">Public</option>
      <option value="police">Police</option>
      <option value="court">Court</option>
    </select>
    <div id="credentials" class="hidden">
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
    </div>
    <button onclick="login()">Login</button>
  </div>

  <!-- Police Portal -->
  <div id="policePortal" class="hidden">
    <div class="card">
      <h2>Register New Case</h2>
      <input type="text" id="aadhaar" placeholder="Aadhaar ID">
      <input type="text" id="accused" placeholder="Accused Name">
      <textarea id="caseDetails" placeholder="Case Details"></textarea>
      <input type="text" id="location" placeholder="Crime Location">
      <input type="text" id="officer" placeholder="Officer Name">
      <label>Crime Date & Time</label>
      <input type="datetime-local" id="crimeDate">
      <label>Registration Date & Time</label>
      <input type="datetime-local" id="regDate">
      <button onclick="registerCaseOnChain()">Register Case</button>
    </div>
    <div class="card">
      <h2>Track Case</h2>
      <input type="text" id="trackInputPolice" placeholder="Enter Evidence ID or Accused Name">
      <button onclick="trackCase('trackInputPolice','policeResults')">Track</button>
      <div id="policeResults"></div>
    </div>
  </div>

  <!-- Court Portal -->
  <div id="courtPortal" class="hidden">
    <div class="card">
      <h2>Court Judgment</h2>
      <label for="evidenceSelect">Select Evidence</label>
      <select id="evidenceSelect"></select>
      <textarea id="judgmentText" placeholder="Enter Judgment"></textarea>
      <label>Closing Date</label>
      <input type="datetime-local" id="closingDate">
      <button onclick="submitJudgment()">Submit Judgment</button>
    </div>
    <div class="card">
      <h2>Track Case</h2>
      <input type="text" id="trackInputCourt" placeholder="Enter Evidence ID or Accused Name">
      <button onclick="trackCase('trackInputCourt','courtResults')">Track</button>
      <div id="courtResults"></div>
    </div>
  </div>

  <!-- Public Portal -->
  <div id="publicPortal" class="hidden">
    <div class="card">
      <h2>Track Case</h2>
      <input type="text" id="trackInputPublic" placeholder="Enter Evidence ID or Accused Name">
      <button onclick="trackCase('trackInputPublic','publicResults')">Track</button>
      <div id="publicResults"></div>
    </div>
  </div>
</div>

<script>
let web3, contract;
const contractAddress="YOUR_DEPLOYES";
const contractABI=[/* ABI GOES HERE */];

window.addEventListener('load', async ()=>{
  if(window.ethereum){
    web3=new Web3(window.ethereum);
    await ethereum.request({method:"eth_requestAccounts"});
    contract=new web3.eth.Contract(contractABI,contractAddress);
  } else alert("Install MetaMask!");
});

function login(){
  const role=document.getElementById('role').value;
  const credentials=document.getElementById('credentials');
  const user=document.getElementById('username').value;
  const pass=document.getElementById('password').value;

  document.getElementById('policePortal').classList.add('hidden');
  document.getElementById('courtPortal').classList.add('hidden');
  document.getElementById('publicPortal').classList.add('hidden');

  if(role==="police"||role==="court"){ credentials.classList.remove('hidden'); }
  if(role==="public"){ credentials.classList.add('hidden'); document.getElementById('publicPortal').classList.remove('hidden'); }
  if(role==="police" && user==="police" && pass==="1234"){ document.getElementById('policePortal').classList.remove('hidden'); credentials.classList.add('hidden'); }
  if(role==="court" && user==="court" && pass==="1234"){ document.getElementById('courtPortal').classList.remove('hidden'); credentials.classList.add('hidden'); populateAllEvidence(); }
}

async function registerCaseOnChain(){
  const accounts=await web3.eth.getAccounts();
  const aadhaar=document.getElementById('aadhaar').value;
  const accused=document.getElementById('accused').value;
  const details=document.getElementById('caseDetails').value;
  const loc=document.getElementById('location').value;
  const officer=document.getElementById('officer').value;
  const crimeDate=document.getElementById('crimeDate').value;
  const regDate=document.getElementById('regDate').value;

  await contract.methods.registerCase(aadhaar,accused,details,loc,officer,crimeDate,regDate)
    .send({from:accounts[0]});

  alert("Case Registered on Blockchain");
  ['aadhaar','accused','caseDetails','location','officer','crimeDate','regDate'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('accused').readOnly=false;
  populateAllEvidence();
}

async function getAllCases(){ return await contract.methods.getAllCases().call(); }

async function populateAllEvidence(){
  const sel=document.getElementById('evidenceSelect');
  if(!sel) return;
  const cs=await getAllCases();
  sel.innerHTML='<option value="">Select Evidence</option>';
  cs.forEach(c=>{
    sel.innerHTML += `<option value="${c.evidenceID}">${c.evidenceID} - ${c.accused}</option>`;
  });
}

async function submitJudgment(){
  const accounts=await web3.eth.getAccounts();
  const eid=document.getElementById('evidenceSelect').value;
  const text=document.getElementById('judgmentText').value;
  const closeDate=document.getElementById('closingDate').value;
  if(!eid) return alert("Select Evidence");
  await contract.methods.submitJudgment(eid,text,closeDate).send({from:accounts[0]});
  alert("Judgment Submitted");
  document.getElementById('judgmentText').value='';
  document.getElementById('closingDate').value='';
}

async function trackCase(inputId,resultId){
  const key=document.getElementById(inputId).value.trim();
  const cs=await getAllCases();
  const results=cs.filter(c=>c.evidenceID===key||c.accused.toLowerCase()===key.toLowerCase());
  let html="";
  if(results.length===0){ html="No results found."; }
  else { results.forEach(c=>{
    html+=`<div class="card">
      <p><b>Evidence ID:</b> ${c.evidenceID}</p>
      <p><b>Accused:</b> ${c.accused}</p>
      <p><b>Aadhaar:</b> ${c.aadhaar}</p>
      <p><b>Case:</b> ${c.caseDetails}</p>
      <p><b>Location:</b> ${c.location}</p>
      <p><b>Officer:</b> ${c.officer}</p>
      <p><b>Crime Date:</b> ${c.crimeDate}</p>
      <p><b>Reg Date:</b> ${c.regDate}</p>
      <p><b>Judgment:</b> ${c.judgment}</p>
      <p><b>Closing:</b> ${c.closingDate}</p>
    </div>`;
  }); }
  document.getElementById(resultId).innerHTML=html;
}
</script>
</body>
</html>
