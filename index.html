<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Evidence Tracking System</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: white;
      padding: 20px;
    }
    select, input, button, textarea {
      padding: 8px;
      margin: 5px;
      border-radius: 5px;
    }
    .section {
      display: none;
      margin-top: 20px;
      border: 1px solid #333;
      padding: 20px;
      background: #1f1f1f;
    }
  </style>
</head>
<body>
  <h2>ğŸŸ¦ Login Page</h2>
  <label for="role">Select Role:</label>
  <select id="role">
    <option value="public">Public</option>
    <option value="police">Police</option>
    <option value="court">Court</option>
  </select>
  <div id="loginFields">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
  </div>
  <button onclick="login()">Login</button>

  <div id="publicSection" class="section">
    <h3>ğŸ§‘â€ğŸ¤â€ğŸ§‘ Public Portal - Track Case</h3>
    <input type="text" id="publicTrackInput" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('public')">Track</button>
    <pre id="publicResult"></pre>
  </div>

  <div id="policeSection" class="section">
    <h3>ğŸ‘® Police Portal - Register New Case</h3>
    <input type="text" id="aadhaar" placeholder="Aadhaar ID">
    <input type="text" id="accused" placeholder="Accused Name">
    <input type="text" id="caseDetail" placeholder="Case">
    <input type="text" id="location" placeholder="Location">
    <input type="text" id="officer" placeholder="Officer Name">
    <input type="datetime-local" id="regDateTime">
    <input type="datetime-local" id="crimeDateTime">
    <button onclick="registerCase()">Register New Case</button>

    <h4>Track Case</h4>
    <input type="text" id="policeTrackInput" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('police')">Track</button>
    <pre id="policeResult"></pre>
  </div>

  <div id="courtSection" class="section">
    <h3>âš–ï¸ Court Portal - Submit Judgment</h3>
    <select id="evidenceSelect"></select><br>
    <textarea id="judgmentText" placeholder="Judgment Text"></textarea><br>
    <input type="date" id="closingDate">
    <button onclick="submitJudgment()">Submit Judgment</button>

    <h4>Track Case</h4>
    <input type="text" id="courtTrackInput" placeholder="Evidence ID or Accused Name">
    <button onclick="trackCase('court')">Track</button>
    <pre id="courtResult"></pre>
  </div>

  <script>
    let web3;
    let contract;
    const address = "YOUR_CONTRACT_ADDRESS";
    const abi = [...] // Paste ABI here

    async function init() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await ethereum.enable();
        contract = new web3.eth.Contract(abi, address);
        populateEvidenceDropdown();
      } else alert("Install MetaMask");
    }

    function login() {
      const role = document.getElementById('role').value;
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      document.getElementById('publicSection').style.display = 'none';
      document.getElementById('policeSection').style.display = 'none';
      document.getElementById('courtSection').style.display = 'none';

      if (role === 'public') {
        document.getElementById('loginFields').style.display = 'none';
        document.getElementById('publicSection').style.display = 'block';
      } else if (role === 'police' && username === 'police' && password === '1234') {
        document.getElementById('policeSection').style.display = 'block';
      } else if (role === 'court' && username === 'court' && password === '4321') {
        document.getElementById('courtSection').style.display = 'block';
        populateEvidenceDropdown();
      } else {
        alert('Invalid credentials');
      }
    }

    async function registerCase() {
      const accounts = await web3.eth.getAccounts();
      const aadhaar = document.getElementById('aadhaar').value;
      const accused = document.getElementById('accused').value;
      const caseDetail = document.getElementById('caseDetail').value;
      const location = document.getElementById('location').value;
      const officer = document.getElementById('officer').value;
      const regDateTime = document.getElementById('regDateTime').value;
      const crimeDateTime = document.getElementById('crimeDateTime').value;
      const uniqueId = 'CID' + Math.floor(Math.random() * 100000);
      const evidenceId = 'EID' + Math.floor(Math.random() * 1000000);

      await contract.methods.registerEvidence(
        aadhaar, accused, caseDetail, location, officer, regDateTime, crimeDateTime, uniqueId, evidenceId
      ).send({ from: accounts[0] });

      alert(`Registered!\nUnique ID: ${uniqueId}\nEvidence ID: ${evidenceId}`);
      populateEvidenceDropdown();
    }

    async function trackCase(section) {
      const id = document.getElementById(section + 'TrackInput').value;
      const result = await contract.methods.getEvidence(id).call();
      const formatted = `ğŸ†” Unique ID: ${result[0]}
ğŸ“„ Evidence ID: ${result[1]}
ğŸ‘¤ Accused Name: ${result[2]}
ğŸ“ Case: ${result[3]}
ğŸ“ Location: ${result[4]}
ğŸ‘® Officer: ${result[5]}
ğŸ•’ Reg Time: ${result[6]}
ğŸ“… Crime Time: ${result[7]}
âš– Judgment: ${result[8]}
ğŸ“… Closing: ${result[9]}`;
      document.getElementById(section + 'Result').textContent = formatted;
    }

    async function submitJudgment() {
      const accounts = await web3.eth.getAccounts();
      const evidenceId = document.getElementById('evidenceSelect').value;
      const text = document.getElementById('judgmentText').value;
      const date = document.getElementById('closingDate').value;

      await contract.methods.updateJudgment(evidenceId, text, date).send({ from: accounts[0] });
      alert('Judgment Submitted');
    }

    async function populateEvidenceDropdown() {
      const ids = await contract.methods.getAllEvidenceIds().call();
      const dropdown = document.getElementById('evidenceSelect');
      dropdown.innerHTML = '';
      ids.forEach(id => {
        const option = document.createElement('option');
        option.value = id;
        option.text = id;
        dropdown.appendChild(option);
      });
    }

    window.onload = init;
  </script>
</body>
</html>
