<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Evidence Tracking System</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body { background:#0f172a; color:#f8fafc; font-family:sans-serif; padding:2rem; }
    h1,h2 { text-align:center; color:#22d3ee; }
    .container {
      background:#1e293b; padding:1.5rem; border-radius:12px; max-width:700px;
      margin:1rem auto; box-shadow:0 0 10px #0ea5e9;
    }
    input, textarea, select, button {
      width:100%; padding:10px; margin:10px 0;
      border:none; border-radius:8px; font-size:1rem;
    }
    button {
      background:#22d3ee; color:#0f172a; font-weight:bold; cursor:pointer;
    }
    pre {
      background:#0f172a; padding:1rem; border-radius:10px; white-space:pre-wrap;
    }
    #policeLogin, #courtLogin, #policePortal, #courtPortal, #publicPortal { display:none; }
  </style>
</head>
<body>
  <h1>Evidence Tracking System</h1>

  <div class="container" id="roleSelectBox">
    <select id="roleSelect" onchange="showLogin()">
      <option value="">Select Role</option>
      <option value="police">Police</option>
      <option value="court">Court</option>
      <option value="public">Public</option>
    </select>
  </div>

  <div class="container" id="policeLogin">
    <input id="policeUser" placeholder="Police Username" />
    <input id="policePass" type="password" placeholder="Password" />
    <button onclick="login('police')">Login</button>
  </div>

  <div class="container" id="courtLogin">
    <input id="courtUser" placeholder="Court Username" />
    <input id="courtPass" type="password" placeholder="Password" />
    <button onclick="login('court')">Login</button>
  </div>

  <div class="container" id="policePortal">
    <h2>Register New Case</h2>
    <input id="aadhaar" placeholder="Aadhaar ID" />
    <input id="accused" placeholder="Accused Name" />
    <input id="location" placeholder="Crime Location" />
    <input id="officer" placeholder="Officer Name" />
    <input id="datetime" type="datetime-local" />
    <button onclick="registerCase()">Register Case</button>

    <h3>Track Case</h3>
    <input id="trackPoliceInput" placeholder="Evidence ID or Accused Name" />
    <button onclick="trackCase('police')">Track</button>
    <pre id="policeTrackResult"></pre>
  </div>

  <div class="container" id="courtPortal">
    <h2>Court Judgment</h2>
    <input id="evidenceSearch" placeholder="Evidence ID or Accused Name" />
    <button onclick="selectEvidence()">Select Evidence</button>
    <div id="judgmentDiv" style="display:none;">
      <textarea id="judgmentText" placeholder="Judgment Text"></textarea>
      <input id="judgmentClosingDate" type="date" />
      <button onclick="submitJudgment()">Submit Judgment</button>
    </div>

    <h3>Track Case</h3>
    <input id="trackCourtInput" placeholder="Evidence ID or Accused Name" />
    <button onclick="trackCase('court')">Track</button>
    <pre id="courtTrackResult"></pre>
  </div>

  <div class="container" id="publicPortal">
    <h2>Public Case Tracking</h2>
    <input id="trackPublicInput" placeholder="Evidence ID or Accused Name" />
    <button onclick="trackCase('public')">Track</button>
    <pre id="publicTrackResult"></pre>
  </div>

  <script>
    const policeCreds = { username:'police1', password:'1234' };
    const courtCreds = { username:'court1', password:'5678' };

    function showLogin(){
      const role = document.getElementById('roleSelect').value;
      document.getElementById('roleSelectBox').style.display='none';
      document.getElementById('publicPortal').style.display = role==='public'?'block':'none';
      document.getElementById('policeLogin').style.display = role==='police'?'block':'none';
      document.getElementById('courtLogin').style.display = role==='court'?'block':'none';
    }

    function login(role){
      const uname = document.getElementById(role+'User').value;
      const pwd = document.getElementById(role+'Pass').value;
      const valid = (role==='police' && uname===policeCreds.username && pwd===policeCreds.password) ||
                    (role==='court' && uname===courtCreds.username && pwd===courtCreds.password);
      if(valid){
        document.getElementById(role+'Login').style.display='none';
        document.getElementById(role+'Portal').style.display='block';
      } else alert('Invalid credentials');
    }

    async function registerCase(){
      const aadhaar = document.getElementById('aadhaar').value;
      const accused = document.getElementById('accused').value;
      const location = document.getElementById('location').value;
      const officer = document.getElementById('officer').value;
      const datetime = document.getElementById('datetime').value;

      if(!aadhaar || !accused || !location || !officer || !datetime) return alert('Fill all fields');

      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const from = accounts[0];

      await contract.methods.registerCase(aadhaar, accused, location, officer, datetime).send({ from });
      alert('Case registered successfully!');
    }

    let selectedForJudgment;
    async function selectEvidence(){
      const input = document.getElementById('evidenceSearch').value.toLowerCase();
      const total = await contract.methods.getTotalCases().call();
      for(let i=0;i<total;i++){
        const d = await contract.methods.getCaseByIndex(i).call();
        if(d[1].toLowerCase() === input || d[2].toLowerCase() === input){
          selectedForJudgment = d[1];
          document.getElementById('judgmentDiv').style.display='block';
          return;
        }
      }
      alert('Case not found');
    }

    async function submitJudgment(){
      if(!selectedForJudgment) return alert('Select an evidence');
      const judgmentText = document.getElementById('judgmentText').value;
      const closingDate = document.getElementById('judgmentClosingDate').value;

      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const from = accounts[0];

      await contract.methods.submitJudgment(selectedForJudgment, judgmentText, closingDate).send({ from });
      alert('Judgment submitted');
    }

    async function trackCase(role){
      const input = document.getElementById('track'+role.charAt(0).toUpperCase()+role.slice(1)+'Input').value.toLowerCase();
      const output = document.getElementById(role+'TrackResult');

      const total = await contract.methods.getTotalCases().call();
      for(let i=0;i<total;i++){
        const d = await contract.methods.getCaseByIndex(i).call();
        if(d[1].toLowerCase() === input || d[2].toLowerCase() === input){
          output.textContent = `ðŸ†” Unique ID: ${d[0]}\nðŸ“„ Evidence ID: ${d[1]}\nðŸ“ Case: ${d[2]}\nðŸ“ Location: ${d[3]}\nðŸ‘® Officer: ${d[4]}\nðŸ•’ Time: ${new Date(d[5]*1000).toLocaleString()}\nâš– Judgment: ${d[6]}\nðŸ“… Closing: ${d[7]}`;
          return;
        }
      }
      output.textContent = 'Case not found.';
    }

    const contractAddress = 'PASTE_YOUR_DEPLOYED_CONTRACT_ADDRESS_HERE';
    const contractABI = [/* PASTE_YOUR_ABI_HERE */];
    const web3 = new Web3(window.ethereum);
    const contract = new web3.eth.Contract(contractABI, contractAddress);
  </script>
</body>
</html>
